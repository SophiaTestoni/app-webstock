<header class="header">
  <h1 class="title">GESTÃO DE ESTOQUE </h1>
</header>

<div class="formulario">
  <form #f="ngForm">
    <mat-card class="card">
      <mat-card-content>
        <mat-card-header>
          <mat-card-title><h4>Pesquisa</h4></mat-card-title>    
        </mat-card-header>
        <mat-form-field>
                <input matInput 
                       [(ngModel)]="idItem" 
                       name="idItem"  
                       placeholder="Pesquise por ID do item" 
                       id="idItem" 
                       step="1" min="1"/>
          </mat-form-field>
      </mat-card-content>
        <mat-card-actions>
          <button  class="btnPrimary"
                   color="primary" 
                   mat-raised-button 
                   value="Pesquisar ID" 
                   (click)="consultarPorIdItem()">Pesquisar</button>
          <button  class="btnPrimary"
                   color="primary" 
                   mat-raised-button 
                   value="Todas" 
                   (click)="consultarTodos()">Mostrar todos</button>
          <button  color="warn" mat-raised-button value="Todas" 
                   (click)="consultarEstoqueBaixo()">Mostrar estoque crítico</button>
        </mat-card-actions>
    </mat-card>
  </form>
</div>

<!-- PARTE MOSTRADA APENAS QUANDO BUSCADO POR ITEM (showAll = false) -->
<div class="table" *ngIf="!showAll">
<app-item [item]="estoque.item" *ngIf="!showAll"></app-item>
    
<div *ngIf="!showAll">
  <h2 class="subtitle">Estoque</h2>
  <mat-table [dataSource]="dataSource2" matSort>

    <!-- Progress Column -->
    <ng-container matColumnDef="idItem">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Id Item </mat-header-cell>
      <mat-cell *matCellDef="let r" data-label="data"> {{r.item.idItem}} </mat-cell>
    </ng-container>
    
    <!-- Progress Column -->
    <ng-container matColumnDef="localizacao">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Localizacao </mat-header-cell>
      <mat-cell *matCellDef="let r" data-label="data"> {{r.localizacao}} </mat-cell>
    </ng-container>

    <!-- Progress Column -->
    <ng-container matColumnDef="estoqueReal">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Estoque Real </mat-header-cell>
        <mat-cell *matCellDef="let r" data-label="data"> {{r.estoqueReal}} </mat-cell>
      </ng-container>
    
      <ng-container matColumnDef="estoqueSeguranca">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Estoque Segurança </mat-header-cell>
        <mat-cell *matCellDef="let r" data-label="data"> {{r.item.estoqueSeguranca}} </mat-cell>
      </ng-container>

      <!-- Progress Column -->
    <ng-container matColumnDef="dataFutura">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Data Futura </mat-header-cell>
        <mat-cell *matCellDef="let r" data-label="data"> {{r.dataFutura}} </mat-cell>
      </ng-container>

    <!-- Progress Column -->
    <ng-container matColumnDef="estoqueFuturo">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Estoque Futuro </mat-header-cell>
        <mat-cell *matCellDef="let r" data-label="data"> {{r.estoqueFuturo}} </mat-cell>
      </ng-container>
      
    <ng-container matColumnDef="editar">
    <mat-header-cell *matHeaderCellDef mat-sort-header> Detalhes </mat-header-cell>
    <mat-cell *matCellDef="let r" data-label="editar"> <abbr title="oi"><mat-icon (click)="consultarPorIdItem(r.item.idItem)">list_alt</mat-icon></abbr>
    <mat-icon *ngIf="r.finalizada" >edit</mat-icon></mat-cell>
        
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns1"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns1;">
    </mat-row>
  </mat-table>
</div>

<app-log [logsDataSource]="logsDataSource"  *ngIf="!showAll"></app-log>
</div>

<!-- PARTE MOSTRADA APENAS QUANDO BUSCADO POR VARIOS (showAll = true) -->
<div *ngIf="showAll" class="table">
<mat-accordion  *ngFor="let item of dataSource.data; index as i" >
      <mat-expansion-panel (opened)="openClose(true,item)"
                           (closed)="openClose(false,item)" >
        <mat-expansion-panel-header >
          <mat-panel-title>
            <div class="example-spacer">
              <abbr title="Estoque em nivel crítco">
                <mat-icon *ngIf="item.estoqueFuturo && item.estoqueFuturo > item.item.estoqueSeguranca && item.estoqueReal > item.item.estoqueSeguranca" class="icon-ok">done</mat-icon>
                <mat-icon *ngIf="item.estoqueReal <= item.item.estoqueSeguranca" class="icon-critico">priority_high</mat-icon>
                <mat-icon *ngIf="item.estoqueFuturo && item.estoqueFuturo<=item.item.estoqueSeguranca && item.estoqueReal > item.item.estoqueSeguranca" class="icon-warning">warning</mat-icon>
              </abbr>
            </div>
            <div class="example-spacer">
              ID: {{item.item.idItem}} - {{item.item.familia}}
            </div>
            <div class="example-spacer"></div>
          </mat-panel-title>
          <mat-panel-description>
            <div class="example-spacer">
              {{item.item.descricao}}
            </div>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <mat-table [dataSource]="dataSource" matSort >
    
            <!-- Progress Column -->
            <ng-container matColumnDef="localizacao">
              <mat-header-cell *matHeaderCellDef mat-sort-header> Localizacao </mat-header-cell>
              <mat-cell *matCellDef="let r" data-label="data"> {{item.localizacao}} </mat-cell>
            </ng-container>

            <!-- Progress Column -->
            <ng-container matColumnDef="estoqueReal">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Estoque Real </mat-header-cell>
                <mat-cell *matCellDef="let r" data-label="data"> {{item.estoqueReal}} </mat-cell>
              </ng-container>
            
              <ng-container matColumnDef="estoqueSeguranca">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Estoque Segurança </mat-header-cell>
                <mat-cell *matCellDef="let r" data-label="data"> {{item.item.estoqueSeguranca}} </mat-cell>
              </ng-container>

              <!-- Progress Column -->
            <ng-container matColumnDef="dataFutura">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Data Futura </mat-header-cell>
                <mat-cell *matCellDef="let r" data-label="data"> {{item.dataFutura}} </mat-cell>
              </ng-container>

            <!-- Progress Column -->
            <ng-container matColumnDef="estoqueFuturo">
                <mat-header-cell *matHeaderCellDef mat-sort-header> Estoque Futuro </mat-header-cell>
                <mat-cell *matCellDef="let r" data-label="data"> {{item.estoqueFuturo}} </mat-cell>
              </ng-container>
              
            <ng-container matColumnDef="editar">
            <mat-header-cell *matHeaderCellDef mat-sort-header> Detalhes </mat-header-cell>
            <mat-cell *matCellDef="let r" data-label="editar"> <abbr title="oi"><mat-icon (click)="consultarPorIdItem(item.item.idItem)">list_alt</mat-icon></abbr>
            <mat-icon *ngIf="r.finalizada" >edit</mat-icon></mat-cell>
                
            </ng-container>

            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;">
            </mat-row>
          </mat-table>
          
      </mat-expansion-panel>
    </mat-accordion>
  </div> 